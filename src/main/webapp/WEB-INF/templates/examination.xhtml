<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
  xmlns:p="http://primefaces.org/ui">
  <h:body>
  <h:form id="frmExam">
  	<p:panel class="move-up exam--str">
		<p:outputPanel rendered="#{!examinationBean.patientIsDead()}" class="blok-button--within">
	  		<p:outputPanel class="not-overlay button-link button-link--blue" style="#{examinationBean.editMode ? 'display:inline-block' : 'display:none'}"> 
	  			<p:commandLink class="ui-icon ui-icon-Document-Add"  update=":frmEdtExamId:pnlExamEdtId" oncomplete="PF('edtExamVar').show()" action="#{examinationBean.findExam(0)}"/>
          		<p:commandLink id="btn-addexam" value="Добавить обследование" update=":frmEdtExamId:pnlExamEdtId" oncomplete="PF('edtExamVar').show()" action="#{examinationBean.findExam(0)}"/>
          	</p:outputPanel>
          	<p:outputPanel class="not-overlay button-link button-link--blue margin-left--big" style="#{!examinationBean.patientIsDead() ? 'display:inline-block' : 'display:none'}">
          		<p:commandLink id="btn-print" action="#{examinationBean.printReport(4, true)}">
			  		<p:outputPanel class="ui-icon ui-icon-lett" />
              		<h:outputText value="Печать направления на флюорографию" />
         		</p:commandLink>
         	</p:outputPanel>
      	 	<p:outputPanel  id="surveyedmsg" class="not-overlay button-link patient-death margin-left--big"  style="#{examinationBean.haveNotSurveyed ? 'display:inline-block' : 'display:none'}">
      	 		<p:outputPanel class="ui-icon ui-icon-warning"/>
      			<p:outputLabel value="Пациент давно не проходил обследование"/>
       	 	</p:outputPanel>  
		</p:outputPanel>  
	<p:scrollPanel mode="native" style="max-height: 350px"> 
	<p:dataTable id="examTable" var="item" value="#{examinationBean.examinations}" class="my-table exam my-table--fixed" emptyMessage="#{msg['ExamList.Empty']}">
        <p:column headerText="Дата"> 
			<p:outputPanel class="move">  
			  <h:outputText value="#{item.dat}" >
				<f:convertDateTime pattern="dd.MM.yyyy"/>
			  </h:outputText>
			</p:outputPanel>	  
		</p:column>
	    <p:column headerText="Населенный пункт">
			<p:outputPanel class="move">                
			<h:outputText value="#{item.RMedicalOrgMain.RMedicalOrgTer.name}" />
			</p:outputPanel>	  
         </p:column>	    
         <p:column headerText="Медицинская организация">
			<p:outputPanel class="move hide">
		  	<h:outputText value="#{item.RMedicalOrgMain.name}" />
	        </p:outputPanel>
          </p:column>
          <p:column headerText="Вид">
			<p:outputPanel class="move">
			  <h:outputText value="#{item.RExamType.name}" />
			</p:outputPanel>	  
          </p:column>
          <p:column headerText="Результат">
			<p:outputPanel class="move">
			  <h:outputText value="#{item.RResultType.name}" />
			</p:outputPanel>	  
          </p:column>	    
          <p:column headerText="Верификация">
			<p:outputPanel class="move">
			  <h:outputText value="#{item.RVerification.name}" />
			</p:outputPanel>	  
          </p:column>
          <p:column headerText="Действия" rendered="#{examinationBean.editMode}" class="not-overlay align-center--text">
			<p:outputPanel class="move">  
		    <p:commandLink id="update-exam" update=":frmEdtExamId:pnlExamEdtId" oncomplete="PF('edtExamVar').show()" action="#{examinationBean.findExam(item.id)}" class="ui-icon ui-icon-edit-exam"/>
		    <p:tooltip for="update-exam" value="Редактировать" class="my-tooltip"/>
		    <p:commandLink id="delete-exam" update=":frmDelExamId:pnlExamDelId" oncomplete="PF('delExamVar').show()" action="#{examinationBean.findExam(item.id)}" class="ui-icon ui-icon-delete-exam margin-left--mini"/>
		    <p:tooltip for="delete-exam" value="Удалить" class="my-tooltip"/>
			</p:outputPanel>
	    </p:column>
       </p:dataTable>
      </p:scrollPanel> 
      </p:panel>
     </h:form>
      
      <h:form id="frmEdtExamId">
	    <p:dialog id="edtExamId" widgetVar="edtExamVar" modal="true" header="Редактировать обследование" resizable="false" class="my-overlay my-overlay--not-close add-exam--str">
	       <p:outputPanel id="pnlExamEdtId" class="move-up">
	      <h:panelGrid columns="2" class="invis invis--overlay">
	        <h:outputLabel for="dob" value="Дата обследования" />
			<p:calendar id="dob" value="#{examinationBean.selectedExamination.dat}" locale="ru" pattern="dd.MM.yyyy" class="data" required="true" label="Дата обследования" />
			
	        <p:outputLabel for="regmo" value="Регион" />
		     <p:selectOneMenu id="regmo"  value="#{examinationBean.selectedMor}" converter="#{examinationBean.morConverter}" class="my-select" style="#{examinationBean.moRegionList.size() == 0 ?'color:#d7d7d7;' : 'color:#00000;'}">
		       <p:ajax listener="#{examinationBean.morSelected}" update="npmo mo" />
	          <f:selectItem itemLabel="#{examinationBean.moRegionList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		       <f:selectItems value="#{examinationBean.moRegionList}" var="r" itemLabel="#{r.regId} - #{r.name}" itemValue="#{r}" />
		     </p:selectOneMenu>
		     
	        <p:outputLabel for="npmo" value="Населенный пункт" />
		    <p:selectOneMenu id="npmo"  value="#{examinationBean.selectedMot}" converter="#{examinationBean.motConverter}" class="my-select">
		      <p:ajax listener="#{examinationBean.motSelected}" update="mo" />
	          <f:selectItem itemLabel="#{examinationBean.moTerList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		      <f:selectItems value="#{examinationBean.moTerList}" var="r" itemLabel="#{r.id.terId} - #{r.name}" itemValue="#{r}" />
		    </p:selectOneMenu>
		    
	        <p:outputLabel for="mo" value="Наименование МО" />
		    <p:selectOneMenu id="mo" value="#{examinationBean.selectedMom}" converter="#{examinationBean.momConverter}" class="my-select">
	          <f:selectItem itemLabel="#{examinationBean.moMainList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		      <f:selectItems value="#{examinationBean.moMainList}" var="r" itemLabel="#{r.id.lpuId} - #{r.name}" itemValue="#{r}" />
		    </p:selectOneMenu>
		    
	        <h:outputLabel for="vid" value="Вид обследования" />
		    <p:selectOneMenu id="vid" value="#{examinationBean.selectedExamination.RExamType}" converter="#{examinationBean.extConverter}" class="my-select" required="true" label="Вид обследования">
	          <f:selectItem itemLabel="#{examinationBean.extList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		      <f:selectItems value="#{examinationBean.extList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		    </p:selectOneMenu>
		    
	        <h:outputLabel for="rez" value="Результат" />
		    <p:selectOneMenu id="rez" value="#{examinationBean.selectedExamination.RResultType}" converter="#{examinationBean.restypeConverter}" class="my-select">
	          <f:selectItem itemLabel="#{examinationBean.restypeList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		      <f:selectItems value="#{examinationBean.restypeList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		    </p:selectOneMenu>
		    
	        <h:outputLabel for="mf" value="Марка флюороаппарата" />
			<p:selectOneMenu id="mf" class="my-select">
			  <f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
			</p:selectOneMenu>
			
	        <h:outputLabel for="ver" value="Верификация диагноза" />
		    <p:selectOneMenu id="ver" value="#{examinationBean.selectedExamination.RVerification}" converter="#{examinationBean.verConverter}" class="my-select">
	          <f:selectItem itemLabel="#{examinationBean.verList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		      <f:selectItems value="#{examinationBean.verList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		    </p:selectOneMenu>
		</h:panelGrid>
	      
		<p:outputPanel class="blok-button--within--down">
			<p:messages id="msg-exam" autoUpdate="false" />
			<p:commandButton id="btn-saveexam" value="Сохранить" update=":frmExam:examTable msg-exam :frmExam:surveyedmsg" action="#{examinationBean.saveExam()}" oncomplete="if (args &amp;&amp; !args.validationFailed) PF('edtExamVar').hide()" class="button-volume button-volume--mini" icon="ui-icon-save"/>
			<p:commandButton id="btn-cancelexam" value="Отменить" immediate="true" oncomplete="PF('edtExamVar').hide()" class="button-volume button-volume--mini margin-left--big" icon="ui-icon-undo"/>
	       </p:outputPanel>
	      </p:outputPanel>
	    </p:dialog>
      </h:form>
      
      <h:form id="frmDelExamId">
	    <p:outputPanel id="pnlExamDelId">
          <p:dialog id="delExamId" widgetVar="delExamVar" modal="true" header="Удалить обследование" resizable="false" class="my-overlay my-overlay--not-close delete-exam--str">
            <h:panelGrid columns="2" class="invis invis--overlay move-up">
              <h:outputLabel for="p1" value="Дата обследования" />
              <h:outputText id="p1" value="#{examinationBean.selectedExamination.dat}">
              	<f:convertDateTime pattern="dd.MM.yyyy"/>
              </h:outputText>
              <h:outputLabel for="p2" value="Медицинская организация" />
              <h:outputText id="p2" value="#{examinationBean.selectedExamination.RMedicalOrgMain.name}" />
              <h:outputLabel for="p3" value="Вид обследования" />
              <h:outputText id="p3" value="#{examinationBean.selectedExamination.RExamType.name}" />
              <h:outputLabel for="p4" value="Результат" />
              <h:outputText id="p4" value="#{examinationBean.selectedExamination.RResultType.name}" />
              <h:outputLabel for="p5" value="Верификация диагноза" />
              <h:outputText id="p5" value="#{examinationBean.selectedExamination.RVerification.name}" />
            </h:panelGrid>
	    	<p:outputPanel class="blok-button--within--down">
            	<p:commandButton id="btn-confirmdel" value="Удалить" update=":frmExam:examTable :frmExam:surveyedmsg" action="#{examinationBean.delExam()}" oncomplete="PF('delExamVar').hide()" class="button-volume button-volume--mini" icon="ui-icon-delete"/>
				<p:commandButton id="btn-canceldel" value="Отменить" oncomplete="PF('delExamVar').hide()" class="button-volume button-volume--mini margin-left--big" icon="ui-icon-undo"/>
            </p:outputPanel>
	  	</p:dialog>
       </p:outputPanel>
      </h:form>
  </h:body>
</html>
