<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">
<h:head>
  <title>Флюрокартотека</title>
  <h:outputScript library="js" name="locale.js" />
  <f:metadata>
    <f:viewAction action="#{listmanBean.search()}" />
  </f:metadata>
</h:head>

<h:body>
	<p:outputPanel class="content">

		<h:form>
			<h:panelGrid id="searchParams" columns="10" focus="fam">
				<p:outputLabel for="fam" value="Фамилия" />
				<p:inputText id="fam" value="#{listmanBean.srcFam}" />
				<p:outputLabel for="im" value="Имя" />
				<p:inputText id="im" value="#{listmanBean.srcIm}" />
				<p:outputLabel for="ot" value="Отчество" />
				<p:inputText id="ot" value="#{listmanBean.srcOt}" />
				<p:outputLabel for="dr" value="Дата рождения" />
				<p:calendar id="dr" value="#{listmanBean.srcDr}" locale="ru" pattern="dd.MM.yyyy" />
				<p:commandButton value="Найти" action="#{listmanBean.search()}" update="patientTable" />
				<p:commandButton value="Сбросить" action="#{listmanBean.clearSearch()}" update="searchParams patientTable" />
			</h:panelGrid>
	
			<p:dataTable id="patientTable" value="#{listmanBean.patients}" var="v">
				<p:column headerText="Просмотр">
					<p:link value="Просмотр" outcome="editman">
						<f:param name="patId" value="#{v.id}"/>
					</p:link>
				</p:column>

				<p:column headerText="Фамилия">
					<h:outputText value="#{v.lastName}" />
				</p:column>
				
				<p:column headerText="Имя">
					<h:outputText value="#{v.firstName}" />
				</p:column>

				<p:column headerText="Отчество">
					<h:outputText value="#{v.fatherName}" />
				</p:column>

				<p:column headerText="Дата рождения">
					<h:outputText value="#{v.datBirth}">
					  <f:convertDateTime locale="ru" />
					</h:outputText>
				</p:column>

				<p:column headerText="Пол">
					<h:outputText value="#{v.gender.name}" />
				</p:column>

				<p:column headerText="Населенный пункт">
					<h:outputText value="#{v.address.livCity}" />
				</p:column>

				<p:column headerText="Адрес">
					<h:outputText value="#{v.address.livStreet}" />
				</p:column>

				<p:column headerText="Дата последнего обследования">
					<p:commandLink update=":frmBrowseExam:browseExamId" oncomplete="PF('browseExamVar').show()" action="#{examinationBean.loadExam(v.id)}" >
						<h:outputText value="смотреть"/>
					      <f:param name="editable" value="false"/>
						<f:param name="patId" value="#{v.id}"/>
					</p:commandLink>   
				</p:column>

				<p:column headerText="Результат">
					<h:outputText value="Норма" />
				</p:column>

				<p:column headerText="Верификация">
					<h:outputText value="неизвестно" />
				</p:column>
			</p:dataTable>

			<h:panelGrid columns="1">
				<p:link outcome="editman">
					<h:outputText value="Просмотр"/>
				</p:link>   							
				<p:link outcome="editman" >
					<f:param name="editable" value="true"/>
					<h:outputText value="Добавить пациента"/>
				</p:link>   							
				<p:commandLink update=":frmPrint:pnlDlg" oncomplete="PF('print').show()" >
					<h:outputText value="Отчетные формы"/>
				</p:commandLink>   
				<p:commandLink update=":frmFind:pnlDlg" oncomplete="PF('find').show()" >
					<h:outputText value="Фильтр записей"/>
				</p:commandLink>   
			</h:panelGrid>
		</h:form>

		<h:form id="frmBrowseExam">  
			<p:dialog id="browseExamId" widgetVar="browseExamVar" modal="true" header="Пациент" resizable="false">
			  <ui:include src="WEB-INF/templates/examination.xhtml"/>
			</p:dialog>
		</h:form>


		<h:form id="frmFind">
			<p:dialog id="dlg" widgetVar="find" modal="true"
				header="Фильтр записей" resizable="false" class="my_overley">
				<p:outputPanel id="pnlDlg">
					<p:outputLabel value="Адрес проживания" />
					<h:panelGrid columns="2">
						<p:outputLabel for="reg" value="Регион" />
						<p:selectOneMenu id="reg">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="np" value="Населенный пункт" />
						<p:selectOneMenu id="np">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="ul" value="Улица" />
						<p:selectOneMenu id="ul">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
					</h:panelGrid>
					<p:outputLabel value="МО прикрепления" />
					<h:panelGrid columns="2">
			        	<p:outputLabel for="regmo"  value="Регион" />
				        <p:selectOneMenu id="regmo"  value="#{editmanBean.selectedMor}" converter="#{editmanBean.morConverter}">
				          <p:ajax listener="#{editmanBean.morSelected}" update="npmo" />
				          <f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
				          <f:selectItems value="#{editmanBean.moRegionList}" var="r" itemLabel="#{r.regId} - #{r.name}" itemValue="#{r}" />
				        </p:selectOneMenu>
						<p:outputLabel for="npmo" value="Населенный пункт" />
						<p:selectOneMenu id="npmo">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="nmo" value="ЛПУ" />
						<p:selectOneMenu id="nmo">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="p" value="Поликлиника" />
						<p:selectOneMenu id="p">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
					</h:panelGrid>
					<p:outputLabel value="Контингенты населения" />
					<h:panelGrid columns="2">
			        	<p:outputLabel for="dg" value="Декретированная группа" />
				        <p:selectOneMenu id="dg" converter="#{editmanBean.dgConverter}">
				          <f:selectItem itemLabel="-- отсутствует --" itemValue="#{null}" />
				          <f:selectItems value="#{editmanBean.decrList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
				        </p:selectOneMenu>
		
			        	<p:outputLabel for="mg" value="Медицинская группа" />
				        <p:selectOneMenu id="mg" converter="#{editmanBean.mgConverter}">
				          <f:selectItem itemLabel="-- отсутствует --" itemValue="#{null}" />
				          <f:selectItems value="#{editmanBean.medList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
				        </p:selectOneMenu>
		
			        	<p:outputLabel for="rg" value="Социальная группа" />
				        <p:selectOneMenu id="rg" converter="#{editmanBean.sgConverter}">
				          <f:selectItem itemLabel="-- отсутствует --" itemValue="#{null}" />
				          <f:selectItems value="#{editmanBean.socList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
				        </p:selectOneMenu>
					</h:panelGrid>
					<p:outputLabel value="Обследования" />
					<h:panelGrid columns="2">
						<p:outputLabel for="npo" value="Населенный пункт" />
						<p:selectOneMenu id="npo">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="lpu" value="ЛПУ" />
						<p:selectOneMenu id="lpu">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="rez" value="Результат" />
						<p:selectOneMenu id="rez">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="ver" value="Верификация" />
						<p:selectOneMenu id="ver">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
					</h:panelGrid>
					<h:panelGrid columns="4">
						<p:outputLabel value="Период:   с" />
						<p:calendar id="dn" value="#{null}" locale="ru" />
						<p:outputLabel value="по" />
						<p:calendar id="dk" value="#{null}" locale="ru" />
					</h:panelGrid>
					<p:commandButton id="btnDo" value="Применить" />
					<p:commandButton id="btnCancel" value="Сбросить" />
				</p:outputPanel>
			</p:dialog>
		</h:form>

		<h:form id="frmPrint">
			<p:dialog id="dlg" widgetVar="print" modal="true"
				header="Отчетные формы" resizable="false" class="my_overley">
				<p:outputPanel id="pnlDlg">
					<p:outputLabel value="Уровень отчета" />
					<h:panelGrid columns="2">
						<p:outputLabel for="np" value="Населенный пункт" />
						<p:selectOneMenu id="np">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="mo" value="Медицинская организация" />
						<p:selectOneMenu id="mo">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
						<p:outputLabel for="p" value="Подразделение" />
						<p:selectOneMenu id="p">
							<f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
						</p:selectOneMenu>
					</h:panelGrid>
					<h:panelGrid columns="4">
						<p:outputLabel value="Период:   с" />
						<p:calendar id="dn" value="#{null}" locale="ru" />
						<p:outputLabel value="по" />
						<p:calendar id="dk" value="#{null}" locale="ru" />
					</h:panelGrid>
					<p:outputLabel value="Отчеты:" />
					<h:panelGrid columns="2">
						<p:outputLabel value="1. Флюороосмотры социальных групп населения" />
						<p:link value="Сформировать" href="report?id=1">
							<f:param name="id" value="1" />
						</p:link>
						<p:outputLabel
							value="2. Флюороосмотры декретированных групп населения" />
						<p:link value="Сформировать" href="report?id=3">
							<f:param name="id" value="3" />
						</p:link>
						<p:outputLabel
							value="3. Флюороосмотры медицинских групп населения" />
						<p:link value="Сформировать" href="report?id=2">
							<f:param name="id" value="2" />
						</p:link>
					</h:panelGrid>
				</p:outputPanel>
			</p:dialog>
		</h:form>
	</p:outputPanel>
</h:body>

</html>
