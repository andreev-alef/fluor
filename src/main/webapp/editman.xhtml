<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fias="http://java.sun.com/jsf/composite/components">

<h:head>
  <title>Флюрокартотека</title>
  <h:outputScript library="js" name="locale.js" />
  <f:metadata>
    <f:viewAction action="#{editmanBean.loadPatient(param['patId'])}" />
    <f:viewParam name="editable" value="#{editmanBean.editMode}" />
  </f:metadata>
</h:head>

<h:body>
<h:outputStylesheet library="css" name="reset.css"/>
<h:outputStylesheet library="css" name="fl-custom.css"/>
<h:outputText value="&lt;!--[if lte IE 8]&gt;&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;/fluor/javax.faces.resource/ie8.css.xhtml?ln=css&quot;/&gt;&lt;![endif]--&gt;" escape="false" />

<p:outputPanel class="wrap">
  <p:outputPanel class="div-return">  
  <p:outputPanel class="div-return__fixed">       
  <h:form id="frmIn" class="form-wrap">      
      <p:link outcome="listman" class="return">
        <p:outputPanel class="ui-icon ui-icon-return"/>
        <h:outputText value="Вернуться"  escape="false"/>
      </p:link>
  </h:form>    
  </p:outputPanel>
  </p:outputPanel>
  
  <p:outputPanel class="content">
  	<p:panel rendered="#{editmanBean.patient.id != null}">
	<p:panel header="Обследования пациента" class="blok-out DOM-bad__div" >
	  <p:outputPanel class="ui-icon-lett" />
	  <p:outputPanel class="DOM-bad__button" rendered="#{editmanBean.patient.datDeath == null}">
          <p:commandLink id="btn-print" action="#{editmanBean.printReport(4, true)}" class="button-link button-link--blue">
			  <p:outputPanel class="ui-icon ui-icon-lett" />
              <h:outputText value="Печать направления на флюорографию" />
         </p:commandLink>
         <p:outputPanel rendered="#{examinationBean.haveNotSurveyed}" class="DOM-bad__button"> 
      	 	<p:outputPanel class="button-link patient-death">
      	 	<p:outputPanel class="ui-icon ui-icon-warning"/>
      		<p:outputLabel value="Пациент давно не проходил обследование"/>
       	 </p:outputPanel>  
       </p:outputPanel>
  </p:outputPanel>
		<ui:include src="WEB-INF/templates/examination.xhtml" />
	</p:panel>
	</p:panel>
	
  <h:form id="frmInf">
    
    <p:panel header="Информация о пациенте" class="blok-out">
	 <p:panel header="Персональные данные" class="blok dva-bloka">
	     <p:panelGrid class="invis invis--colspan personal-data--str">
		  <p:row> <p:column></p:column> <p:column></p:column> <p:column></p:column> <p:column></p:column> </p:row> 		
			<p:row>
			<p:column>
	        	<p:outputLabel for="fam" value="Фамилия" />
			</p:column>
			<p:column colspan="3">
	        	<p:inputText id="fam" value="#{editmanBean.patient.lastName}" maxlength="#{editmanBean.patient.nameFieldSize}" required="true" />
	        	</p:column>
			</p:row>
			
			<p:row>
			<p:column>
	        	<p:outputLabel for="im" value="Имя" />
			</p:column>
			<p:column colspan="3">			  
			<p:inputText id="im" value="#{editmanBean.patient.firstName}" maxlength="#{editmanBean.patient.nameFieldSize}" required="true" />
		        </p:column>
			</p:row>
			
			<p:row>
			<p:column>  
	        	<p:outputLabel for="ot" value="Отчество" />
			</p:column>
		        <p:column colspan="3">
			<p:inputText id="ot" value="#{editmanBean.patient.fatherName}" maxlength="#{editmanBean.patient.nameFieldSize}" />
		        </p:column>
			</p:row>
			
			<p:row>
			<p:column>   
	        	<p:outputLabel for="dr" value="Дата рождения" />
			</p:column>
			<p:column>
				<p:calendar id="dr" value="#{editmanBean.patient.datBirth}" required="true" locale="ru" pattern="#{applicationBean.dateFormat.toPattern()}" />
			</p:column>
			
			<p:column>
	        	<p:outputLabel for="sex" value="Пол" />
			</p:column>
			<p:column>
		        <p:selectOneMenu id="sex" value="#{editmanBean.patient.gender}" converter="#{editmanBean.sexConverter}" required="true" class="my-select">
		          <f:selectItem itemLabel="Выберите пол" itemValue="#{null}" />
		          <f:selectItems value="#{editmanBean.sexList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>
			</p:column>
			</p:row>
			
			<p:row>
			<p:column> 
	        	<p:outputLabel for="grj" value="Гражданство" />
			</p:column>
			<p:column colspan="3">
		        <p:selectOneMenu id="grj" value="#{editmanBean.patient.citizen}" converter="#{editmanBean.citizenConverter}" required="true" class="my-select">
		          <f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
		          <f:selectItems value="#{editmanBean.citizenList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>
			</p:column>
			</p:row>			
			
			<p:row>
			<p:column>   
	        	<p:outputLabel for="ds" value="Дата смерти" />
			</p:column>
			<p:column colspan="3">
				<p:calendar id="ds" value="#{editmanBean.patient.datDeath}" locale="ru" pattern="#{applicationBean.dateFormat.toPattern()}" class="data"/>
			</p:column>
			</p:row>
			
			</p:panelGrid>
		</p:panel>
		
		<p:panel id="adr" header="Адрес проживания в Российской Федерации" class="blok dva-bloka">
			<fias:fias_addr  managedBean="#{fiasEditorEditman}"/>
		</p:panel>
		
		<p:panel header="Контактные данные" class="blok odin-blok">
		  <h:panelGrid columns="2" class="invis tel--str">
		  <p:outputLabel for="tl" value="Телефон" />
		  <p:inputText id="tl" value="#{editmanBean.patient.tel}" />
		  </h:panelGrid>
		</p:panel>      
				   
		
		<p:panel header="Медицинская организация, к которой прикреплен пациент по ОМС" class="blok odin-blok">
			<h:panelGrid columns="2" class="invis oms--str">
	        	<p:outputLabel for="regmo"  value="Регион" />
		        <p:selectOneMenu id="regmo"  value="#{editmanBean.selectedMor}" converter="#{editmanBean.morConverter}" class="my-select"> 
		          <p:ajax listener="#{editmanBean.morSelected}" update="npmo mo clmo adrmo" />
		          <f:selectItem itemLabel="-- Выберите --" itemValue="#{null}" />
		          <f:selectItems value="#{editmanBean.moRegionList}" var="r" itemLabel="#{r.regId} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>
		        
	        	<p:outputLabel for="npmo" value="Населенный пункт" />
		        <p:selectOneMenu id="npmo"  value="#{editmanBean.selectedMot}" converter="#{editmanBean.motConverter}" class="my-select">
		          <p:ajax listener="#{editmanBean.motSelected}" update="mo clmo adrmo" />
                  <f:selectItem itemLabel="#{editmanBean.moTerList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		          <f:selectItems value="#{editmanBean.moTerList}" var="r" itemLabel="#{r.id.terId} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>
		        
	        	<p:outputLabel for="mo" value="Наименование МО" />
		        <p:selectOneMenu id="mo" value="#{editmanBean.selectedMom}" converter="#{editmanBean.momConverter}" class="my-select">
		          <p:ajax listener="#{editmanBean.momSelected}" update="clmo adrmo" />
                  <f:selectItem itemLabel="#{editmanBean.moMainList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		          <f:selectItems value="#{editmanBean.moMainList}" var="r" itemLabel="#{r.id.lpuId} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>
		        
	        	<p:outputLabel for="clmo" value="Поликлиника" />
		        <p:selectOneMenu id="clmo" value="#{editmanBean.selectedMop}" converter="#{editmanBean.mopConverter}" class="my-select">
		          <p:ajax update="adrmo" />
                  <f:selectItem itemLabel="#{editmanBean.moPoliclinicList.size() == 0 ? '-- Список пуст --' : '-- Ничего не выбрано --'}" itemValue="#{null}" noSelectionOption="true" />
		          <f:selectItems value="#{editmanBean.moPoliclinicList}" var="r" itemLabel="#{r.id.polId} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>	        
			
	        	<p:outputLabel for="adrmo" value="Адрес:" />		
				<p:outputLabel id="adrmo" value="#{editmanBean.selectedMom.addr}" class="select-onlyread--label"/>			
			</h:panelGrid>
		</p:panel>
		
		<p:panel header="Контингент населения" class="blok odin-blok">
			<h:panelGrid columns="2" class="invis rguppa--str">
	        	<p:outputLabel for="dg" value="Декретированная группа" />
		        <p:selectOneMenu id="dg" value="#{editmanBean.patient.decrGroup}" converter="#{editmanBean.dgConverter}" class="my-select">
		          <f:selectItem itemLabel="-- отсутствует --" itemValue="#{null}" />
		          <f:selectItems value="#{editmanBean.decrList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>

	        	<p:outputLabel for="mg" value="Медицинская группа" />
		        <p:selectOneMenu id="mg" value="#{editmanBean.patient.medGroup}" converter="#{editmanBean.mgConverter}" class="my-select">
		          <f:selectItem itemLabel="-- отсутствует --" itemValue="#{null}" />
		          <f:selectItems value="#{editmanBean.medList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>

	        	<p:outputLabel for="rg" value="Группа риска (осмотр 2 раза в год)" />
		        <p:selectOneMenu id="rg" value="#{editmanBean.patient.socGroup}" converter="#{editmanBean.sgConverter}" class="my-select">
		          <f:selectItem itemLabel="-- отсутствует --" itemValue="#{null}" />
		          <f:selectItems value="#{editmanBean.socList}" var="r" itemLabel="#{r.id} - #{r.name}" itemValue="#{r}" />
		        </p:selectOneMenu>
			</h:panelGrid>
		</p:panel>
		
		<p:outputPanel class="blok-button--within--down">
		  <p:messages id="msg-editman" autoUpdate="false" />
		  <p:commandButton id="btn-savepat" value="Сохранить" update="adr msg-editman" action="#{editmanBean.savePatientAndRedirect()}" class="button-volume button-volume--mini" icon="ui-icon-save"/>
		  <p:button id="btn-cancelpat" value="Отменить" outcome="listman" class="button-volume button-volume--mini margin-left--big" icon="ui-icon-undo"/>
		</p:outputPanel>
    </p:panel>
	</h:form>

</p:outputPanel>	
</p:outputPanel>
   	
   	<h:form id="frmException" >
	    <p:ajaxExceptionHandler type="java.lang.Exception"
	                            update="exceptionDialog"
	                            onexception="PF('exceptionDialog').show();" />
	 
	    <p:dialog id="exceptionDialog" header="Ошибка" widgetVar="exceptionDialog"
	              height="100px" class="my-overlay">
			<div class="button--close-dialog">
		  	<p:commandButton value="Закрыть" oncomplete="PF('exceptionDialog').hide()" icon="ui-icon-close" class="button-link button-link--white"/>
			</div>
	        <br/><br/>Сообщение: #{pfExceptionHandler.message} <br/>
	    </p:dialog>
	</h:form>

</h:body>
</html>
